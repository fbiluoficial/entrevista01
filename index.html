<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entrevista Interativa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Estilo para quando o modo de edição está ativo */
        .edit-mode [contenteditable="true"] {
            outline: 2px dashed #3b82f6;
            background-color: #eff6ff;
            padding: 4px;
            border-radius: 4px;
            cursor: text;
        }
        .edit-mode-indicator {
            transition: all 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div id="app" class="max-w-4xl mx-auto p-4 sm:p-6 lg:p-8">
        
        <!-- Cabeçalho e Controles -->
        <header class="bg-white shadow-md rounded-xl p-6 mb-8 sticky top-4 z-10 border border-gray-200">
            <div class="flex flex-col sm:flex-row justify-between items-center">
                <div>
                    <h1 class="text-2xl sm:text-3xl font-bold text-gray-900">Entrevista com Comerciante</h1>
                    <p class="text-sm text-gray-500 mt-1">Responda às questões e edite o conteúdo se necessário.</p>
                </div>
                <div class="flex items-center space-x-4 mt-4 sm:mt-0">
                    <span class="text-sm font-medium text-gray-700">Modo Edição</span>
                    <label for="edit-mode-toggle" class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="edit-mode-toggle" class="sr-only peer">
                        <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 peer-checked:bg-blue-600"></div>
                        <span class="absolute left-1 top-1 w-4 h-4 bg-white rounded-full transition-transform peer-checked:translate-x-full"></span>
                    </label>
                </div>
            </div>
        </header>

        <!-- Container das Questões -->
        <main id="questions-container" class="space-y-6">
            <!-- As questões serão injetadas aqui pelo JavaScript -->
        </main>

        <!-- Botão de Download -->
        <footer class="mt-10 text-center">
            <button id="download-pdf-btn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-transform transform hover:scale-105">
                Baixar Respostas em PDF
            </button>
        </footer>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DADOS DA ENTREVISTA ---
            // Os dados foram extraídos do PDF e opções adicionais foram criadas.
            const initialInterviewData = [
                {
                    question: "Qual é o nome do seu estabelecimento e qual é o tipo de negócio?",
                    options: [
                        "Meu bar se chama 'O Cantinho da Andressa' e é um pequeno comércio e bar.",
                        "É uma loja de roupas chamada 'Estilo & Cia'.",
                        "É uma padaria e confeitaria 'Pão Doce'.",
                        "É uma oficina mecânica 'Auto Reparos Rápidos'."
                    ],
                    selected: 0 // Resposta original do PDF
                },
                {
                    question: "Onde seu estabelecimento está localizado?",
                    options: [
                        "Fica no povoado São Bento, em Buriti-MA.",
                        "No centro da capital São Luís-MA.",
                        "Em uma galeria comercial em Imperatriz-MA.",
                        "Em uma área rural de Caxias-MA."
                    ],
                    selected: 0
                },
                {
                    question: "Você utiliza computador, caixa digital ou algum programa para gerenciar o estoque ou as vendas?",
                    options: [
                        "Não, não uso computador, caixa digital ou programas para gerenciar estoque ou vendas.",
                        "Sim, uso um sistema completo no computador.",
                        "Uso apenas uma planilha para controlar o caixa.",
                        "Tenho um aplicativo de vendas no celular."
                    ],
                    selected: 0
                },
                {
                    question: "Como você faz o controle do seu estoque, especialmente em relação à validade dos produtos?",
                    options: [
                        "Controlo tudo no olho e em cadernos. A validade eu verifico na hora de arrumar as prateleiras.",
                        "Uso um software que me alerta sobre produtos perto de vencer.",
                        "Tenho um funcionário dedicado apenas para o controle de validade.",
                        "Não faço controle de validade, apenas de quantidade."
                    ],
                    selected: 0
                },
                {
                    question: "Quais são os principais desafios ou dificuldades que você enfrenta no dia a dia do seu negócio?",
                    options: [
                        "Perco o controle do estoque, da validade e a divulgação é difícil sem internet.",
                        "A concorrência com grandes supermercados.",
                        "A falta de mão de obra qualificada na região.",
                        "O alto custo dos impostos e aluguel."
                    ],
                    selected: 0
                },
                {
                    question: "Você tem interesse em usar a internet, como um site ou redes sociais, para o seu negócio?",
                    options: [
                        "Sim, tenho muito interesse! Acho que poderia atrair mais clientes, mas não sei por onde começar.",
                        "Não, acredito que não traria retorno para o meu tipo de negócio.",
                        "Já tentei usar, mas achei muito complicado e desisti.",
                        "Prefiro investir em propaganda local, como rádio e panfletos."
                    ],
                    selected: 0
                },
                {
                    question: "Como você registra e acompanha os pedidos dos seus clientes e as informações de vendas?",
                    options: [
                        "Anoto os pedidos e vendas em um caderno. É um pouco demorado e às vezes me perco.",
                        "Registro tudo em um sistema de ponto de venda (PDV).",
                        "Uso um aplicativo de mensagens para anotar os pedidos.",
                        "Confio na memória, pois são poucos clientes fixos."
                    ],
                    selected: 0
                },
                {
                    question: "Você já ouviu falar sobre a Lei Geral de Proteção de Dados (LGPD)?",
                    options: [
                        "Não, nunca ouvi falar sobre a LGPD. O que é isso?",
                        "Sim, já ouvi falar, mas não sei como se aplica ao meu negócio.",
                        "Sim, e já tomei algumas medidas para me adequar.",
                        "Acredito que essa lei só se aplica a grandes empresas."
                    ],
                    selected: 0
                },
                {
                    question: "Como você armazena e gerencia os dados pessoais dos seus clientes?",
                    options: [
                        "Anoto em cadernos ou num papel solto se o cliente pede para guardar algo.",
                        "Tenho uma agenda de contatos no celular.",
                        "Armazeno em um sistema seguro com senha.",
                        "Não costumo guardar dados de clientes."
                    ],
                    selected: 0
                },
                {
                    question: "Que tipo de informações você gostaria de ter para auxiliar na tomada de decisões?",
                    options: [
                        "Gostaria de saber quais produtos vendem mais, quais estão parados, e quanto estou lucrando.",
                        "Relatórios sobre o fluxo de clientes na loja por horário.",
                        "Análise de perfil dos meus clientes (idade, gênero, etc.).",
                        "Comparativos de preços com meus concorrentes."
                    ],
                    selected: 0
                },
                {
                    question: "Você estaria aberto a implementar novas ferramentas ou sistemas para otimizar a gestão?",
                    options: [
                        "Sim, com certeza! Se for algo que ajude e não for muito complicado, estou aberta.",
                        "Talvez, mas tenho receio dos custos envolvidos.",
                        "Não, prefiro continuar com meus métodos tradicionais.",
                        "Apenas se alguém pudesse me treinar para usar a nova ferramenta."
                    ],
                    selected: 0
                },
                {
                    question: "Se uma nova solução fosse implementada, o que você esperaria que ela melhorasse?",
                    options: [
                        "Espero que diminua meu trabalho manual, ajude a não perder produtos e que eu entenda melhor minhas vendas.",
                        "Que aumentasse as vendas em pelo menos 50%.",
                        "Que me permitisse gerenciar o negócio à distância, pelo celular.",
                        "Que automatizasse completamente o atendimento ao cliente."
                    ],
                    selected: 0
                },
                {
                    question: "Com que frequência você lida com problemas que poderiam ser resolvidos com a ajuda da tecnologia?",
                    options: [
                        "Praticamente todo dia. O controle de estoque e o tempo gasto com anotações poderiam ser mais fáceis.",
                        "Raramente, talvez uma vez por mês.",
                        "Apenas quando preciso fazer um pedido grande para fornecedores.",
                        "Nunca, acredito que meus problemas não são relacionados à tecnologia."
                    ],
                    selected: 0
                }
            ];
            
            let interviewData;
            const questionsContainer = document.getElementById('questions-container');
            const editModeToggle = document.getElementById('edit-mode-toggle');
            const downloadPdfBtn = document.getElementById('download-pdf-btn');
            const appContainer = document.getElementById('app');

            // --- FUNÇÕES ---

            // Carrega o estado do localStorage ou usa os dados iniciais
            function loadState() {
                const savedData = localStorage.getItem('interviewAppState');
                if (savedData) {
                    interviewData = JSON.parse(savedData);
                } else {
                    // Copia os dados iniciais para não modificar o original diretamente
                    interviewData = JSON.parse(JSON.stringify(initialInterviewData));
                }
            }
            
            // Salva o estado atual no localStorage
            function saveState() {
                localStorage.setItem('interviewAppState', JSON.stringify(interviewData));
            }

            // Renderiza as questões na tela
            function renderInterview() {
                questionsContainer.innerHTML = '';
                interviewData.forEach((item, qIndex) => {
                    const questionBlock = document.createElement('div');
                    questionBlock.className = 'bg-white p-6 rounded-xl shadow-sm border border-gray-100';
                    
                    const questionText = document.createElement('p');
                    questionText.className = 'text-lg font-semibold text-gray-800 mb-4';
                    questionText.textContent = item.question;
                    questionText.dataset.qIndex = qIndex;
                    questionText.dataset.type = 'question';
                    
                    const optionsList = document.createElement('div');
                    optionsList.className = 'space-y-3';
                    
                    item.options.forEach((option, oIndex) => {
                        const optionLabel = document.createElement('label');
                        optionLabel.className = 'flex items-center p-4 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-50 transition-colors';
                        
                        const radioInput = document.createElement('input');
                        radioInput.type = 'radio';
                        radioInput.name = `question-${qIndex}`;
                        radioInput.value = oIndex;
                        radioInput.className = 'h-5 w-5 text-blue-600 border-gray-300 focus:ring-blue-500';
                        radioInput.checked = item.selected === oIndex;
                        
                        radioInput.addEventListener('change', () => {
                            item.selected = oIndex;
                            saveState();
                        });

                        const optionText = document.createElement('span');
                        optionText.className = 'ml-4 text-gray-700';
                        optionText.textContent = option;
                        optionText.dataset.qIndex = qIndex;
                        optionText.dataset.oIndex = oIndex;
                        optionText.dataset.type = 'option';
                        
                        optionLabel.appendChild(radioInput);
                        optionLabel.appendChild(optionText);
                        optionsList.appendChild(optionLabel);
                    });
                    
                    questionBlock.appendChild(questionText);
                    questionBlock.appendChild(optionsList);
                    questionsContainer.appendChild(questionBlock);
                });
                
                // Atualiza o estado do modo de edição após a renderização
                updateEditModeState();
            }

            // Habilita ou desabilita o modo de edição
            function toggleEditMode() {
                appContainer.classList.toggle('edit-mode');
                updateEditModeState();
            }

            // Atualiza os atributos 'contenteditable' com base no estado do toggle
            function updateEditModeState() {
                const isEditMode = editModeToggle.checked;
                appContainer.classList.toggle('edit-mode', isEditMode);
                const editableElements = questionsContainer.querySelectorAll('[data-type="question"], [data-type="option"]');
                editableElements.forEach(el => {
                    el.contentEditable = isEditMode;
                });
            }

            // Lida com a edição de texto
            function handleTextEdit(e) {
                const el = e.target;
                const qIndex = el.dataset.qIndex;
                const type = el.dataset.type;

                if (!qIndex || !type) return;

                if (type === 'question') {
                    interviewData[qIndex].question = el.textContent;
                } else if (type === 'option') {
                    const oIndex = el.dataset.oIndex;
                    interviewData[qIndex].options[oIndex] = el.textContent;
                }
                saveState();
            }

            // Gera e baixa o PDF
            function generatePdf() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({
                    orientation: 'p',
                    unit: 'mm',
                    format: 'a4'
                });

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(18);
                doc.text('Respostas da Entrevista', 105, 20, { align: 'center' });

                let y = 35;
                const margin = 15;
                const maxWidth = doc.internal.pageSize.getWidth() - (margin * 2);

                interviewData.forEach((item, index) => {
                    if (y > 260) { // Adiciona nova página se o conteúdo estiver muito baixo
                        doc.addPage();
                        y = 20;
                    }
                    
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(12);
                    const questionText = `${index + 1}. ${item.question}`;
                    const questionLines = doc.splitTextToSize(questionText, maxWidth);
                    doc.text(questionLines, margin, y);
                    y += (questionLines.length * 5) + 2;

                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(11);
                    const selectedOption = item.options[item.selected];
                    const answerText = `R: ${selectedOption}`;
                    const answerLines = doc.splitTextToSize(answerText, maxWidth - 5); // Indentação para resposta
                    
                    doc.setTextColor(80, 80, 80);
                    doc.text(answerLines, margin + 5, y);
                    doc.setTextColor(0, 0, 0);
                    y += (answerLines.length * 5) + 10;
                });

                doc.save('respostas-entrevista.pdf');
            }

            // --- INICIALIZAÇÃO E EVENTOS ---
            
            loadState();
            renderInterview();

            editModeToggle.addEventListener('change', toggleEditMode);
            downloadPdfBtn.addEventListener('click', generatePdf);
            
            // Usar 'blur' para salvar quando o usuário clica fora do elemento editado
            questionsContainer.addEventListener('blur', (e) => {
                if(e.target.isContentEditable) {
                    handleTextEdit(e);
                }
            }, true);
        });
    </script>
</body>
</html>

